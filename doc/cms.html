<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <!--<meta http-equiv="Content-Security-Policy" content="default-src 'none'">-->
    <title>jCastle documentation</title>
    <link rel="stylesheet" href="../static/lib/bootstrap-4.6.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/lib/AdminLTE-3.2.0/dist/css/adminlte.min.css">
    <link rel="stylesheet" href="../static/lib/fontawesome-6.1.1/css/all.min.css">
    <link rel="stylesheet" href="./style.css" type="text/css">
    

    <script type="text/javascript" src="../static/lib/jquery-3.6.0.min.js"></script>
    <!--<script>
    window.jQuery = window.$ = require('jquery');
    </script>-->
    <script type="text/javascript" src="../static/lib/bootstrap-4.6.1/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" src="../static/lib/AdminLTe-3.2.0/dist/js/adminlte.min.js"></script>
    <script type="text/javascript" src="../static/lib/fontawesome-6.1.1/js/all.min.js"></script>
    <script type="text/javascript" src="./api.js"></script>

    <style>
        body {
            overflow-x: hidden;
        }
        #column2::-webkit-scrollbar {
            display: none;
        }
        .blink_me {
          animation: blinker 5s linear infinite;
        }

        @keyframes blinker {
          50% {
            opacity: 0;
          }
        }
        .cursor-pointer {
            cursor:  pointer;
        }
        .mark {
          background-color:  transparent;
        }
    </style>
</head>
<body class="apidoc" id="api-section-index">

    <div id="content" class="clearfix">
      <div id="column2" class="interior">
        <div id="intro" class="interior">
          <a href="/" title="Go back to the home page">
            <span style="font-size: 2rem">jCastle</span> <span style="color: #AED6F1; font-size: 14px">(v2.0)</span>
          </a>
        </div>

        <ul>
<li><a href="mcrypt.html">mcrypt - Message Crypt</a></li>
<li><a href="algorithms.html">Message Crypt Algorithms</a></li>
<li><a href="mcrypt-mode.html">Mcrypt Modes</a></li>
<li><a href="digest.html">digest - Message Digest</a></li>
<li><a href="hashes.html">Hash Algorithms</a></li>
<li><a href="mac.html">mac - Message Authentication Code</a></li>
<li><a href="mac-mode.html">MAC Modes</a></li>
<li><a href="hmac.html">hmac - Hash MAC</a></li>
<li><a href="kdf.html">kdf - Key Derive Function</a></li>
<li><a href="pki.html">pki - Public Key Infrastructure</a></li>
<li><a href="pki-rsa.html">pki.rsa - RSA</a></li>
<li><a href="pki-dsa.html">pki.dsa - DSA</a></li>
<li><a href="pki-ecdsa.html">pki.ecdsa - ECDSA</a></li>
<li><a href="pki-kcdsa.html">pki.kcdsa - KCDSA</a></li>
<li><a href="pki-eckcdsa.html">pki.eckcdsa - EC-KCDSA</a></li>
<li><a href="pki-elgamal.html">pki.elgamal - ElGamal</a></li>
<li><a href="dh.html">dh - Diffie–Hellman Key Exchange</a></li>
<li><a href="ecdh.html">ecdh - DH with Elliptic Curve Cryptographic System</a></li>
<li><a href="asn1.html">asn1 - Abstract Syntax Notation #1</a></li>
<li><a href="certConfig.html">certConfig - openssl.cnf reader or parser</a></li>
<li><a href="certificate.html">certificate - X.509 Certificate</a></li>
<li><a href="cms.html">cms - Cryptographic Message Syntax</a></li>
<li><a href="pfx.html">pfx - Personal Information Exchange</a></li>
<li><a href="keywrap.html">keywrap - Key Wrapping Algorithm</a></li>
<li><a href="jose.html">jose - Javascript Object Signing & Encryption</a></li>
<li><a href="prng.html">prng - Pseudorandom number generator</a></li>
        </ul>
      </div>

      <div id="column1" data-id="index" class="interior">
        <header class="header">
          <div class="header-container">
            <h1>jCastle v2.0 documentation</h1>
            <button class="theme-toggle-btn" id="theme-toggle-btn" title="Toggle dark mode/light mode" aria-label="Toggle dark mode/light mode" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" height="24" width="24">
              <path fill="none" d="M0 0h24v24H0z" />
              <path d="M11.1 12.08c-2.33-4.51-.5-8.48.53-10.07C6.27 2.2 1.98 6.59 1.98 12c0 .14.02.28.02.42.62-.27 1.29-.42 2-.42 1.66 0 3.18.83 4.1 2.15A4.01 4.01 0 0111 18c0 1.52-.87 2.83-2.12 3.51.98.32 2.03.5 3.11.5 3.5 0 6.58-1.8 8.37-4.52-2.36.23-6.98-.97-9.26-5.41z"/>
              <path d="M7 16h-.18C6.4 14.84 5.3 14 4 14c-1.66 0-3 1.34-3 3s1.34 3 3 3h3c1.1 0 2-.9 2-2s-.9-2-2-2z"/>
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" height="24" width="24">
              <path d="M0 0h24v24H0z" fill="none" />
              <path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.79 1.42-1.41zM4 10.5H1v2h3v-2zm9-9.95h-2V3.5h2V.55zm7.45 3.91l-1.41-1.41-1.79 1.79 1.41 1.41 1.79-1.79zm-3.21 13.7l1.79 1.8 1.41-1.41-1.8-1.79-1.4 1.4zM20 10.5v2h3v-2h-3zm-8-5c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm-1 16.95h2V19.5h-2v2.95zm-7.45-3.91l1.41 1.41 1.79-1.8-1.41-1.41-1.79 1.8z"/>
            </svg>
            </button>
          </div>
          
          <hr>
        </header>

        <!-- TOC -->

        <div id="apicontent">


<ul class="d-none">
<li><a href="mcrypt.html">mcrypt - Message Crypt</a></li>
<li><a href="algorithms.html">Message Crypt Algorithms</a></li>
<li><a href="mcrypt-mode.html">Mcrypt Modes</a></li>
<li><a href="digest.html">digest - Message Digest</a></li>
<li><a href="hashes.html">Hash Algorithms</a></li>
<li><a href="mac.html">mac - Message Authentication Code</a></li>
<li><a href="mac-mode.html">MAC Modes</a></li>
<li><a href="hmac.html">hmac - Hash MAC</a></li>
<li><a href="kdf.html">kdf - Key Derive Function</a></li>
<li><a href="pki.html">pki - Public Key Infrastructure</a></li>
<li><a href="pki-rsa.html">pki.rsa - RSA</a></li>
<li><a href="pki-dsa.html">pki.dsa - DSA</a></li>
<li><a href="pki-ecdsa.html">pki.ecdsa - ECDSA</a></li>
<li><a href="pki-kcdsa.html">pki.kcdsa - KCDSA</a></li>
<li><a href="pki-eckcdsa.html">pki.eckcdsa - EC-KCDSA</a></li>
<li><a href="pki-elgamal.html">pki.elgamal - ElGamal</a></li>
<li><a href="dh.html">dh - Diffie–Hellman Key Exchange</a></li>
<li><a href="ecdh.html">ecdh - DH with Elliptic Curve Cryptographic System</a></li>
<li><a href="asn1.html">asn1 - Abstract Syntax Notation #1</a></li>
<li><a href="certConfig.html">certConfig - openssl.cnf reader or parser</a></li>
<li><a href="certificate.html">certificate - X.509 Certificate</a></li>
<li><a href="cms.html">cms - Cryptographic Message Syntax</a></li>
<li><a href="pfx.html">pfx - Personal Information Exchange</a></li>
<li><a href="keywrap.html">keywrap - Key Wrapping Algorithm</a></li>
<li><a href="jose.html">jose - Javascript Object Signing & Encryption</a></li>
<li><a href="prng.html">prng - Pseudorandom number generator</a></li>
</ul>


<section>

  <h3>Class:<code>jCastle.cms</code><span><a class="mark" href="#class-cms" id="class-cms">#</a></span><a aria-hidden="true" class="legacy" id="class_cms"></a></h3>

  <p>CMS 알고리듬이란 Cryptographic Message Syntax의 약자로 각종 데이터를 안전하게 송수신하기 위해 사용되는 메시지 암호화 규격입니다.</p>
  <p>CMS 컨텐츠 타입에는 data, signedData, envelopedData, digestedData, encryptedData, authenticatedData 및 authEnvelopedData가 있습니다.</p>
  <p>관련 문서:<br/>
    <a href="https://datatracker.ietf.org/doc/html/rfc5652">Cryptographic Message Syntax (CMS)</a><br/>
    <a href="https://datatracker.ietf.org/doc/html/rfc3565">Use of the Advanced Encryption Standard (AES) Encryption
            Algorithm in Cryptographic Message Syntax (CMS)</a>
  </p>

  <!-- new jCastle.cms -->
  <h4><code>new jCastle.cms()</code><span><a class="mark" href="#new-cms-intance" id="new-cms-instance">#</a></span><a aria-hidden="true" class="legacy" id="new_cms_instance"></a></h4>

  <p><code>jCastle.cms</code> 오브젝트를 생성합니다.</p>

  <!-- jCastle.cms.create() -->
  <h4>Static method: <code>jCastle.cms.create()</code><span><a class="mark" href="#static-cms-create" id="static-cms-create">#</a></span><a aria-hidden="true" class="legacy" id="static_cms_create"></a></h4>

  <p><code>jCastle.cms</code> 오브젝트를 생성합니다. <code>new jCastle.cms()</code>와 동일합니다.</p>

  <ul>
    <li>Return Value: <code>jCastle.cms</code> 오브젝트를 생성하여 리턴합니다.</li>
  </ul>

  <hr>

  <!-- cms.parse(cms, options = {}) -->
  <h4><code>cms.parse(cms, options = {})</code><span><a class="mark" href="#cms-parse" id="cms-parse">#</a></span><a aria-hidden="true" class="legacy" id="cms_parse"></a></h4>

  <p><code>CMS</code> ( Cryptographic Message Syntax) 데이터를 파싱합니다.</p>

  <ul>
    <li><code>cms</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&#x3C;string></a> | <a href="https://nodejs.org/dist/latest-v18.x/docs/api/buffer.html#class-buffer" class="type">&#x3C;Buffer></a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&#x3C;Object></a> 파싱할 스트링 혹은 Buffer 데이터. 객체는 <code>jCastle.asn1</code>으로 파싱한 결과 객체를 말합니다.</li>
    <li><code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&#x3C;Object></a> 옵션 객체
    </li>
  </ul>

  <ul>
    <li>Return Value: 데이터를 파싱하여 그 결과를 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&#x3C;Object></a> 형식으로 리턴합니다.</li>
  </ul>

  <!-- cms.exportCMS(cmsInfo, options = {}) -->
  <h4><code>cms.exportCMS(cmsInfo, options = {})</code><span><a class="mark" href="#cms-exportCMS" id="cms-exportCMS">#</a></span><a aria-hidden="true" class="legacy" id="cms_exportCMS"></a></h4>

  <p>주어진 정보를 가지고 CMS 데이터를 생성합니다.</p>

  <ul>
    <li><code>cmsInfo</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&#x3C;Object></a> CMS 생성에 필요한 스키마 객체</li>
    <li><code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&#x3C;Object></a> 옵션 객체

    </li>
  </ul>

  <ul>
    <li>Return Value: 생성된 CMS 데이터를 <code>format</code>에 따른 형식으로 리턴합니다.</li>
  </ul>

  <!-- cms.export(cmsInfo, options = {}) -->
  <h4><code>cms.export(cmsInfo, options = {})</code><span><a class="mark" href="#cms-export" id="cms-export">#</a></span><a aria-hidden="true" class="legacy" id="cms_export"></a></h4>

  <p><code>cms.exportCMS()</code>와 동일 메소드입니다.</p>

  <p><code>EncryptedData</code> type example:</p>

  <pre class="prettyprint p-4">
var encryptKey = Buffer.from("000102030405060708090a0b0c0d0e0f", "hex");
var encrypteddata_pem = `
-----BEGIN CMS-----
MIAGCSqGSIb3DQEHBqCAMIACAQAwgAYJKoZIhvcNAQcBMB0GCWCGSAFlAwQBAgQQ
rNaWW2F+b+pR/3t732H3QKCABBAuNuLZg/4euGW8ZL1Ko4tzAAAAAAAAAAAAAA==
-----END CMS-----`;
var plaintext = "hello world";

var cms = jCastle.cms.create();
var cms_info = cms.parse(encrypteddata_pem, {
  encryptKey: encryptKey,
});
console.log("cms_info: ", cms_info);

var cms_info2 = {
  contentType: "encryptedData",
  content: {
    encryptedContentInfo: {
      type: "data",
      contentEncryptionAlgorithm: {
        algo: "aes-128-CBC",
      }, //,
      // content: plaintext
    },
  },
};

var cms_data = cms.exportCMS(cms_info2, {
  format: "base64",
  content: plaintext,
  encryptKey: encryptKey,
});
console.log(jCastle.util.lineBreak(cms_data, 64));

var cms_info3 = cms.parse(cms_data, {
  encryptKey: encryptKey,
});
console.log("cms_info3: ", cms_info3);
  </pre>

  <p><code>AuthenticatedData</code> type example:</p>

  <pre class="prettyprint p-4">
var bits = 1024;
var password = "password";
var privkey_pem = `
-----BEGIN PRIVATE KEY-----
MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDOBZhK/11578ky
wgY+TFIFPlceyA4vZgQmHY/k+lzxW/z3bCJtZCydaskMnkUvGMJXk20tWLCitOfl
EdZGJndMFQhJzPQic+uYI/6eevHN5T/eBFbS41tGdHtC8ZBbNuzZdvK8Aheo7n8p
a3jO1wnqLrA72eurZZZjiQgH7JdczfAV4CV6GZFgCqtmWJv3ZFTYb8DoxqcLay99
6DGovaOytuIcE1D6lTdNAJyK9OsPK5K3JK/YeHKJoE54XwhKqY0WA0NyN7M8TkH6
rA9oXEaYmG9O13OkT/MV4j1lCdqzC5HKloeARpQwfHFfLEqyUsG6szgnT9RFGQCe
+e/kLowPAgMBAAECggEAUd/9VwjHYFdAEVD0ZDu2eOj+fHgq0wFq8q7a6bfpye2x
ya6KvAiMhn7SqZYYjo/7ZAxt3hCaGf9lDS8ahcRxsqXFJncyKqMA5PShEuBvSlEq
IZR94M+EDarq9X7EzMs2M3JHIxp9xqAJny9b0m+5O/0UAqUnOHVl3+asb2HCAZoK
rhcStW7plMKCX0GB7wiuFmtH2fgDHGDOU/qtZsUdx/uv7JeD53cEskIUKydH9OBm
I8WbKc5xOyk45BaX4kjGAXMKntc1PvjZhYX1HP8jwIfqggBD1TFCfRiDi1xCPO95
mm9RP/Qx9w+BfQX+1Sjw8O6ZQB7qLXSK0nU2JFICSQKBgQD+NToGqENyAiHWl+tA
m/AjAqBF8vjbqsBsxWT/eFEd/g13raR0LDcF3Ubhtgqa9SdanyT2VpC4UyeELEGP
9cgAJDVtV+52Aznhy3bMdx3dqVHwpm930x7C9CGrUOYIwLFs3kanFbOb9jg0S5Fj
TayciIkI7NgilXGRqPkd98r1UwKBgQDPeWfxdomIoV2yz0YO3xHkaPqE+8L9zp3b
nDliofIGrseDdCEwEai0zNlYkUbLUXWMiMLnDTetYTvl7w7QqE3p/CnbJ/DBoStU
7SbJZ8znyvW/e1oEoSBxOgzChJZVY9APJIGJW1+2IknlD62y2FSVA3YS0KpAlB2T
tkzaNEIa1QKBgQCCJJ3gaqSc6ZqJUp2OJkd6pQ2IwivFylVZWnWqlN5yjG44px1a
nIhO6EoxpBEp4/iR3If/1bGhrHC+qimmmh4adG8l266pnF01zAS2CQWxRc49dff7
UIqfJH1YR8J9GKm9Is7pG6MoZZXAsC9ut4V3Xi9J8nd0vS23dNqVDRdLIQKBgBbu
yHp8K7+adozpNEk4hvXEVMyWN3tudyxrHDy2wdXTQ+JX18NEcG1rpyqPBFA89M1P
4JtBbsIPWVuVDQIrWFFgug+rXoVIl02P2RWyD4gfewJrVAvm83sQe5CUrzlJCxph
YqAYJYAwUhKrpPt7xf2ioE58GhWBSbOmFuCXnibxAoGAUkVYcVwtNd3YbWolIjh2
h1cLyIOkKdvqcRxAl1z/I+wCe7klSSwJCEqcif/Ueh+CqcywsC3Itwg/znhHITaM
ZbuGLJrFuuc9t5hofd5Ht9tkWTQEpI3SNVsou/SbP1Xb+PL6ndPNsSVUPoXvIRdM
wOwbyIdR5BgbRsDIgBbYTLo=
-----END PRIVATE KEY-----`;

/* root */

var root = new jCastle.pki();
root.parsePrivateKey(privkey_pem);
var issuer = [
  {
    name: "countryName",
    value: "KR",
    type: jCastle.asn1.tagPrintableString,
  },
  {
    name: "stateOrProvinceName",
    value: "Chungcheongbuk-do",
    // type: jCastle.asn1.tagUTF8String // default
  },
  {
    name: "localityName",
    value: "Cheongju",
  },
  {
    name: "organizationName",
    value: "jCastle Corp",
  },
  {
    name: "organizationalUnitName",
    value: "WebCert Support",
  },
  {
    name: "commonName",
    value: "jCastle Web CA",
  },
  {
    name: "emailAddress",
    value: "support@jcastle.net",
  },
];

/* alice */

var alice = jCastle.pki.create("RSA");
alice.generateKeypair({
  bits: bits,
  exponent: 0x10001,
});
alice.setPadding("rsaes-oaep");
console.log("alice rsa key generated.");

var alice_privkey_pem = alice.exportPrivateKey({ password: password });
console.log("alice private key pem with password: ");
console.log(alice_privkey_pem);

var alice_subject = [
  {
    name: "countryName",
    value: "KR",
    type: jCastle.asn1.tagPrintableString,
  },
  {
    name: "stateOrProvinceName",
    value: "Seoul",
    // type: jCastle.asn1.tagUTF8String // default
  },
  {
    name: "organizationName",
    value: "DACOCHE",
  },
  {
    name: "commonName",
    value: "Dacoche Web Flatform",
  },
];

var alice_cert_info = {
  type: jCastle.certificate.typeCRT,
  tbs: {
    serial: 750365,
    issuer: issuer,
    subject: alice_subject,
    subjectPublicKeyInfo: alice.getPublicKeyInfo(),
    extensions: {
      keyUsage: {
        list: ["keyEncipherment", "digitalSignature"],
        critical: true,
      },
    },
  },
  algo: {
    signHash: "SHA-256",
    signAlgo: "RSASSA-PKCS1-V1_5", // 'RSASSA-PSS', 'EC', 'DSA'
  },
};
var alice_cert = jCastle.certificate.create();
var alice_cert_pem = alice_cert
  .setSignKey(root)
  .exportCertificate(alice_cert_info);
console.log("alice certificate pem: ");
console.log(alice_cert_pem);

/* bob */

var bob = jCastle.pki.create("RSA");
bob.generateKeypair({
  bits: bits,
  exponent: 0x10001,
});
console.log("bob rsa key generated.");

var bob_privkey_pem = bob.exportPrivateKey({ password: password });
console.log("bob private key pem with password: ");
console.log(bob_privkey_pem);

var bob_subject = [
  {
    name: "countryName",
    value: "KR",
    type: jCastle.asn1.tagPrintableString,
  },
  {
    name: "stateOrProvinceName",
    value: "Seoul",
    // type: jCastle.asn1.tagUTF8String // default
  },
  {
    name: "organizationName",
    value: "Hareem",
  },
  {
    name: "commonName",
    value: "Hareem Food",
  },
];

var bob_cert_info = {
  type: jCastle.certificate.typeCRT,
  tbs: {
    serial: 6649112,
    issuer: issuer,
    subject: bob_subject,
    subjectPublicKeyInfo: bob.getPublicKeyInfo(),
    extensions: {
      keyUsage: {
        list: ["keyEncipherment", "digitalSignature"],
        critical: true,
      },
    },
  },
  algo: {
    signHash: "SHA-256",
    signAlgo: "RSASSA-PKCS1-V1_5", // 'RSASSA-PSS', 'EC', 'DSA'
  },
};
var bob_cert = jCastle.certificate.create();
var bob_cert_pem = bob_cert.setSignKey(root).exportCertificate(bob_cert_info);
console.log("bob certificate pem: ");
console.log(bob_cert_pem);

/* alice exports cms with authenticatedData - ktri */
console.log("alice exports cms with authenticatedData - ktri");

var cms_info = {
  contentType: "authenticatedData",
  content: {
    recipientInfos: [
      {
        type: "keyTransRecipientInfo",
        keyEncryptionAlgorithm: {
          algo: "RSA",
          padding: {
            mode: "RSAES-OAEP", // PKCS1_OAEP
            hashAlgo: "sha-1",
            mgf: "mgf1",
            label: "",
          },
        },
      },
    ],
    macAlgorithm: {
      algorithm: "hmacWithSHA256",
    },
  },
};

var plaintext = "Hello world!";
var cms = jCastle.cms.create();
var options = {
  cmsKey: {
    privateKey: alice_privkey_pem,
    password: password,
    certificate: alice_cert_pem,
    recipient: {
      certificate: bob_cert_pem,
    },
  },
  content: plaintext,
};

var cms_pem = cms.exportCMS(cms_info, options);
console.log("alice cms_pem: ");
console.log(cms_pem);

/* bob parses cms pem */
console.log("bob parses cms pem.");

var cmsKey = {
  privateKey: bob_privkey_pem,
  password: password,
};
var options = {
  cmsKey: cmsKey,
};
var cms_info = cms.parse(cms_pem, options);
console.log("cms_info: ");
console.log(cms_info);
  </pre>

  <p><code>AuthEnvelopedData</code> type example:</p>

  <pre class="prettyprint p-4">
/* alice exports cms with authEnvelopedData - ktri */
console.log("alice exports cms with authEnvelopedData - ktri");

var cms_info = {
  contentType: "authEnvelopedData",
  content: {
    recipientInfos: [
      {
        type: "keyTransRecipientInfo",
        //"identifierType": "subjectKeyIdentifier",
        // identifierType: 'issuerAndSerialNumber', // default
        keyEncryptionAlgorithm: {
          algo: "RSA",
          padding: {
            mode: "RSAES-OAEP", // PKCS1_OAEP
            hashAlgo: "sha-1",
            mgf: "mgf1",
            label: "",
          },
        },
      },
    ],
    authEncryptedContentInfo: {
      contentEncryptionAlgorithm: {
        algo: "aes-128-GCM",
      },
    },
  },
};
var plaintext = Buffer.from("Hello world!");
var cms = jCastle.cms.create();
var options = {
  cmsKey: {
    privateKey: alice_privkey_pem,
    password: password,
    certificate: alice_cert_pem,
    recipient: {
      certificate: bob_cert_pem,
    },
  },
  content: plaintext,
};

var cms_pem = cms.exportCMS(cms_info, options);
console.log("cms_pem: ", cms_pem);
var options = {
  cmsKey: {
    privateKey: bob_privkey_pem,
    password: password,
  },
};
var cms_info = cms.parse(cms_pem, options);
console.log("cms_info: ", cms_info);
  </pre>

  <p><code>SignedData</code> type example:</p>

  <pre class="prettyprint p-4">
/* alice exports cms with signedData */

var content = Buffer.from("alice the queen!");
var cms_info = {
  contentType: "signedData",
  content: {
    digestAlgorithms: ["sha-256"],
    signerInfos: [
      {
        digestAlgorithm: "sha-256",
        signatureAlgorithm: {
          algo: "RSA",
          padding: {
            mode: "RSAES-PKCS-V1_5", // PKCS1_Type_2
          },
        },
      },
    ],
  },
};
var cms = jCastle.cms.create();
var cms_signed_data_pem = cms.exportCMS(cms_info, {
  format: "pem",
  cmsKey: {
    privateKey: alice_privkey_pem,
    password: password,
    certificate: alice_cert_pem,
  },
  certificates: [alice_cert_pem],
  // crls: [
  // alice_crl_pem
  // ],
  content: content,
});
console.log("alice create signed data:");
console.log(cms_signed_data_pem);

/* bob parses cms pem and verifies it */

var cms_info = cms.parse(cms_signed_data_pem);
console.log("cms_info: ", cms_info);
  </pre>

  <p><code>DigestedData</code> type Example:</p>

  <pre class="prettyprint p-4">
var cms_data = `
MGkGCSqGSIb3DQEHBaBcMFoCAQAwBwYFKw4DAhowNgYJKoZIhvcNAQcBoCkEJ0Nv
bnRlbnQtVHlwZTogdGV4dC9wbGFpbg0KDQpoZWxsbyB3b3JsZAQUz8wdr3rAtyPE
1SSbbjxk17TFHyY=`;
var cms = new jCastle.cms();
var cms_info = cms.parse(cms_data);
console.log("cms_info: ", cms_info);

console.log(
  "CMS DigestedData Verification 1: ",
  jCastle.CMS.verifyDigestedData(cms_info)
);

var cms_info2 = {
  contentType: "digestedData",
  content: {
    digestAlgorithm: "sha-1",
    encapContentInfo: {
      type: "data",
      content: "hello world",
    },
  },
};
var cms_data2 = cms.exportCMS(cms_info2, {
  content: "Hello world from jCastle.net\n Jacob Lee greets you!",
  format: "base64",
});
console.log(jCastle.util.lineBreak(cms_data2, 64));

var cms_info3 = cms.parse(cms_data2);
console.log("cms_info3: ", cms_info3);
  </pre>

  <p><code>EnvelopedData</code> type example:</p>

  <pre class="prettyprint p-4">
var cms_pem = `
-----BEGIN CMS-----
MIHtBgkqhkiG9w0BBwOggd8wgdwCAQIxgZKjgY8CAQCgYQYJKoZIhvcNAQUMMFQE
QNwYPo2QkGIoljsJY765zgL/X9DV8Vt84FkndCGrNteJIqt3wmdqdXbOsu+TUgy5
Fr/mYbND5vWnspJuYkzdV30CAggAMAwGCCqGSIb3DQILBQAwDQYJYIZIAWUDBAEt
BQAEGKgbc5C/25urkAsAhTcNPJreqhE0hR+lcjCABgkqhkiG9w0BBwEwHQYJYIZI
AWUDBAECBBBIsUH2oxzBLKY/AuyrnJhJoIAEEKXwYlW4M2qrp3drmZBTznQAAAAA
-----END CMS-----`;
var password = "password";
var plaintext = "hello world";
var algo_expected = "aes-128";
var mode_expected = "cbc";
var cms = new jCastle.cms();
var cms_info = cms.parse(cms_pem, {
  cmsKey: {
    password: password,
  },
});
console.log("cms_info: ", cms_info);

var cms_info = {
  contentType: "envelopedData",
  content: {
    version: 2,
    recipientInfos: [
      {
        type: "passwordRecipientInfo",
        keyDerivationAlgorithm: {
          prfHash: "sha-512",
        },
        keyEncryptionAlgorithm: "aes-256",
      },
    ],
    encryptedContentInfo: {
      contentEncryptionAlgorithm: {
        algo: "aes-128-CBC",
      },
    },
  },
};
var cms_data = cms.exportCMS(cms_info, {
  format: "pem",
  cmsKey: {
    password: password,
  },
  content: plaintext,
});
console.log("cms_data: ", cms_data);

var cms_info2 = cms.parse(cms_data, {
  cmsKey: {
    password: password,
  },
});
console.log("cms_info2: ", cms_info2);
  </pre>

</section>  

        <!-- API END -->
        </div>
      </div>
    </div>

<script src="../static/lib/code-prettify/loader/run_prettify.js"></script>
<!-- this stylesheet's position is important! -->
<link rel="stylesheet" href="../static/lib/code-prettify/loader/skins/tranquil-heart.min.css">
</body>
</html>  