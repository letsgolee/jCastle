<DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<link rel="stylesheet" href="./qunit/qunit-1.19.0.css">

<script src="./qunit/qunit-1.19.0.js"></script>

<script src="../dist/jCastle.min.js"></script>
</head>
<body style="font-family: Consolas, Courier New; font-size: 12px;">
<div id="qunit"></div>
<div id="qunit-fixture"></div>

<script type="text/javascript">

QUnit.module('ASN1');
QUnit.test('Parsing test', assert => {
    // envelopedData
    const code_hex = 
    `30820a4230820a3e06092a864886f70d010703a0820a2f30820a2b0201023182018830820184020100303d303831363009060355040613025553302906035504031e220050006500630075006c006900610072002000560065006e00740075007200650073020101303c06092a864886f70d010107302fa00f300d06096086480165030402030500a11c301a06092a864886f70d010108300d0609608648016503040203050004820100d6b3f5916c8c26a2f2604537e94740ca5aca49bb3240e902a8e49548cdf4855f99dfccb238d28125a3cbd47f339923747660e5b27d11526d550a96abb00a9ba40acd7f66fdd34101847c8d9bf023f0e5135ba3c8f42e1c809ea284bebd70751d40c876f3723c6a6b14c091abdba82ce12548547bdedf12059800e96cdb41a2f8f1fcecadd7fdf4a77b4a3b8b1201dd085432bb010b668ccc78ce94c3e9f28d6eea944b7cbcafc501ef9e0c918c5058b20629629ee5961e76303e00ad7e449edb8b70608c6d4e3f66040115fffb4def298e1341e55dce6e7c679f1c879fa8f2c27f84be1f8e9c2ef0866dac07536c2a7f209cc55646ed7e0d3f32c060eca872fd308006092a864886f70d010701301d060960864801650304010204109e8d877d8003a552859dc6f3b9dfc752a08004820400d6e88ba9eaea9d0d04c4682d4e85117472ef43cfb47206ecca7f9e3180258e5c339d50aa39db2f4ce60a37a2e4b6a6e8292a7a6520a23ad58f7d5794b543b5cfa1b4f7a74655be4a6f9ff783a861e621122d3b8e6ecc066652ebb75c0f386e2655cf2d5ca2bd828cafc3f8a3093f7fb3420816ae906d12945678d1912273c1a9dfb89af530eb3d5c22551a65a0f859cb3790a210a868d89a60752f2b869b17c3b8711a5beba0443135c35f77472aa4341bd983055dbc456b3051798e0f86fe8d58614d7d4d1059500408eb077cc24f3b8c62822a448a7368ae349df9bbdfd68801211ec29175ee8a45cf667a951c64434f152509d09ad111127768eedd1849be853a399bc0e94fb6fb2f7997fda8796106b06b8ec428291fa8467f4b91961ffe3a880e8debc2665b56e641d9d1ac14d210564b53c9272775c460c87df452c841ce9ce5b902957ac173e681a9fe9e5ab4956945f73cada3486f34fdfaa353a40ea8e5342f75cf01c965a271856a4102779e4d75732a280c98def8e258d7b0f7a42c748db66b1d15ea56bd98dc1c9978932835085d2708220e16750a9753d282958d66883631aeabccd5587e2a3f9975d59da32e9667d7f1276b00b768cf3ad22f19003418180c933faf313dab088c3bc2d6ed1ea7a7e37d5e1e22b4602c4cdfd13449bec3c8d7b3d0531feb69c42639725c95cc1fd62f36e423063dc86c82ee87de9b22ac66dae71dad38af62a26d3313c727b88135aa62c5034887ea26c0cb47bf86a6cca53791edffab7fc93eab0d0a2d8ac269083522807efa34af77fcaf8484824cd8bad175ce78bef7af25b6915bc0c446ef95844fce92f18edfc5f7ae1a0ba06e9fe356687ecce29405b16fce94e5d7d1d68e0c885f456c23a8108e7960bcd74837d439b4e8f4079df65615117007e04d2459eb3063faf4ae1141abcda6375d046cf9492972957abd2208ddda5de13c61d06c42259b306f0330bcb57f56e7065487d565a3a5fad81e856c51d06f8f91f5450ca15ce0825ce7199c2bdd4a67845c4210262c05245545a5e0eadd446d0a74b970748fbdc94d92255c395b6e68dddb63092b33605f56e66f323f6226245db65c40e442e8d5e566398b78b197c03c0d0e33dcfb6677a6c5348568077d511cac9ba4adb2587d302188f3e821d3993b75ea0e736aa6984843c62c12498585390bf5cd515093591bff2cf8f814908042aa2b65765f101aa12d1d0431337162f201816a12f11e8f64925927d971e8ce55ada5a6860732051bbd65c307132bd431e32474549a8921d0cff2e2e47976a05da5451e3fe07aff3b7db3171bc78b32632db66e128fc8614fa923943b04b917f7386194b91085c55b99d880baee396d1a2d9c90db883c85f643118ea964f770d68968360a6754b5ffddce00b57134a551cb0b8f4dfe6c7ec1501711fdb9a8048204007b8bf701a533b13a77c85f02dec71ceb7e6d9a0b49eae7d21641718304701c6b8875cd00b30c14c0d73af1fa488ff805ebeeae1e5a3596d2ff6cde3ef60e43b3dd4e6a5dfa5f796255c86fca0400a09a1dd06e781adc1e5063ba9dd94bd5115130d5dccb498fb15fc55db2b08273d097ae034e5db5a77f25e66ad33bda7f35a1e072ad957fa29d31aacd6320b71497582ce6db112bf0737e1ecf19dadf5864b0260361177905c4054bc5dd1d833008489b4459d5e74859fc711f898625fc2fe1bd705832190d42a24e9b1be26a2477aa4a7190da4fb6003d37002769a7163099acc93a3d6c057d01b9b4c2a2525e11f9f4c5cc53f9441d3e07e1d982a568047b4bac59ca4b471a4f213702f01c86d3fa63959d1aba4286fa2fb443741c1af2bbd18ec1fc0d1e631104dec71545fe5583c87d76bb0a1c41457da414941f7e9e4d4bc6857cf43283c1c053e1edea4763edc236ba4384e678261ece08abd65dd9ea5345f4e106dee6d5df4cf30166652a67c0322e5d07101169401a66a23a601c7fcbe103f9c6064f70414f0d4480ea667fa2695c5d9ba8a8eeedd998510814b2ae5824368c7a5e47c67e841678e2724b8a268b002cde9276ef15669f84d6915c217fbafb0ce14d0cfff504af4f473905b37213c49060bf762c64e5f5881464a06b348a6ec98c4b7e6ea86b6152b3eeea2c2dec3b607df5feeced2130d7ef6f3f13b0c23763d617b8ec981aac13b578e27784ef2bacfa7962e5ffdfac44a9383e1e80e03635549e7aa27dd144cdb85e83377d7148f9a5352f9a2c8af713bf05132cdcf3203625678bbe4b3de47f23f0669872b952bd5969f777278956dacc5e2a55d3e1769db6c3b2997453e85ad0a522412aeb34cfd60af4db7a567d3a8db67da431d54c030e01eae84ea173813273abea43af5e4b89dba77ba76de160ac11275fdfd445078dbb168cc575aa00f6f303fff773cb2d5741d63721d03d90ed5001d27c2c504e057b295e4bdffa5211530c1279bab138e1d2d45fc871937f9396f329d111f7112ef5acbcd05b3b0196f750d6f427c72ea1fbac1a6c79f129e848eac7e752c2c89aff5a2ac8cbd2eaa8c4958d5a9e9fc47a84e86851e85c0cdc429c4b2defea7b6cb62a542b209051cb26e0b54960895c18352ce4d6ed95a846d701891b871a2e3a8f7cde3095eb7a90c06542b21ca0fde782d699662ec73617b04f4d10695186cf72250ffa70d03a23f9efcfd276ba793fe923c994b8807f4f5ce87303f7787dbef519ca879b7816ee467efa3a05c3035fda16a605924f61dbdc6889338c29c36457a4aa0ada62cb897e1dfd9458671e3283bca92abd9c2fd7d850af2a042988e0c09a9e0293070be59d0617b30302b96461a89ab6bc42668b06fbb036255db9983bbb05671f2f13d7863e26c46edd8a1034b67d608adda75fdfb4970460a3d6fc257a49d9ab20b35a9fbad10952b50b5ad6a8b0acb8272473cf3da9a502c8b6febeaf45d0fe134d0bf65b53aa7319cbee6531deaedbfb4ec23365d204ac130af2422b1e12c7366f90975c76bd7623fd025f4e720b601ea5680b5a9e23cb00000000`;

    var code = Buffer.from(code_hex.replace(/ /g, ""), 'hex').toString('latin1');

    var asn1 = new jCastle.asn1();
    var obj = asn1.parse(code);

    //console.log(jCastle.asn1.rasterize(obj));

    var der = asn1.getDER(obj);
    //console.log('der remaking: ', der === sample);

    assert.equal(der, code, 'DER Remaking Test');

    assert.equal(obj.items[0].items[0].type, jCastle.asn1.tagOID, 'type test');

    assert.equal(obj.items[0].items[0].value, '1.2.840.113549.1.7.3', 'value test');

    const signed_cert_hex = `
    30 82 05 9B 30 82 04 83 A0 03 02 01 02 02 04 19 42 A5 2F 30 0D 06 09 2A 86 48 86 F7 0D 01
    01 0B 05 00 30 52 31 0B 30 09 06 03 55 04 06 13 02 6B 72 31 10 30 0E 06 03 55 04 0A 0C 07
    79 65 73 73 69 67 6E 31 15 30 13 06 03 55 04 0B 0C 0C 41 63 63 72 65 64 69 74 65 64 43 41
    31 1A 30 18 06 03 55 04 03 0C 11 79 65 73 73 69 67 6E 43 41 20 43 6C 61 73 73 20 31 30 1E
    17 0D 31 35 30 34 32 36 31 35 30 30 30 30 5A 17 0D 31 36 30 35 31 39 31 34 35 39 35 39 5A
    30 71 31 0B 30 09 06 03 55 04 06 13 02 6B 72 31 10 30 0E 06 03 55 04 0A 0C 07 79 65 73 73
    69 67 6E 31 14 30 12 06 03 55 04 0B 0C 0B 70 65 72 73 6F 6E 61 6C 34 49 42 31 0D 30 0B 06
    03 55 04 0B 0C 04 4E 41 43 46 31 2B 30 29 06 03 55 04 03 0C 22 EC 9D B4 EC A4 80 EC 98 A4
    28 29 30 30 31 31 30 34 39 32 30 30 36 30 35 31 30 31 31 30 30 35 32 38 36 30 82 01 22 30
    0D 06 09 2A 86 48 86 F7 0D 01 01 01 05 00 03 82 01 0F 00 30 82 01 0A 02 82 01 01 00 8C A0
    12 C1 7D EF 93 1E 1A 2F 0A 42 9E 3C 60 0A 93 13 05 CF 7E B3 4D 09 13 86 76 E9 F9 47 78 8C
    ED D7 E8 68 22 C1 DB 5E EC 3C C0 0F C3 36 CC 43 D0 62 1E 6F C0 88 97 35 6C 63 FC 85 9B 13
    9D 03 59 51 1E 03 90 2C F2 B8 95 F2 C8 4A BB DC 71 1C A8 4B 66 57 91 10 A3 D9 C3 C3 95 91
    D0 D4 91 12 BF 90 05 50 16 63 6A 9A FC 7B 96 8F C9 D2 2E 2E B9 AC E3 0A 72 FF 78 B4 BD C6
    17 2E 18 4A 9D 02 7F 14 D6 0F 97 10 DD 90 81 6B 33 A0 54 E0 CC 48 DB 31 C4 AF 6E 6B 8D 18
    38 45 60 5C 33 4D 93 A3 41 20 97 CA CE 5A 6E 9E CA 14 64 96 83 AD 21 B8 D5 2D 89 FD F1 9D
    52 66 21 CB 40 55 EC 56 49 E6 43 D1 59 59 EA 74 FC 23 FF 20 FD 64 B5 2E 2F 85 66 C1 1E B3
    59 36 5D 0C D0 AA 62 B8 B1 76 5E F5 3E 86 CD A0 76 0A 32 5F 2D 42 41 13 39 9A 29 E2 C7 5B
    4A CC 93 A6 D3 08 A1 E2 3F B8 96 74 21 39 02 03 01 00 01 A3 82 02 58 30 82 02 54 30 81 8F
    06 03 55 1D 23 04 81 87 30 81 84 80 14 52 04 32 9F 8F 9D 21 72 BA FA 33 98 A8 61 7E 27 33
    24 8D 5F A1 68 A4 66 30 64 31 0B 30 09 06 03 55 04 06 13 02 4B 52 31 0D 30 0B 06 03 55 04
    0A 0C 04 4B 49 53 41 31 2E 30 2C 06 03 55 04 0B 0C 25 4B 6F 72 65 61 20 43 65 72 74 69 66
    69 63 61 74 69 6F 6E 20 41 75 74 68 6F 72 69 74 79 20 43 65 6E 74 72 61 6C 31 16 30 14 06
    03 55 04 03 0C 0D 4B 49 53 41 20 52 6F 6F 74 43 41 20 34 82 02 10 03 30 1D 06 03 55 1D 0E
    04 16 04 14 2C 26 8A 2F 0B C2 10 23 A3 49 40 DC C4 5A 31 56 77 0E 41 B1 30 0E 06 03 55 1D
    0F 01 01 FF 04 04 03 02 06 C0 30 79 06 03 55 1D 20 01 01 FF 04 6F 30 6D 30 6B 06 09 2A 83
    1A 8C 9A 45 01 01 04 30 5E 30 2E 06 08 2B 06 01 05 05 07 02 02 30 22 1E 20 C7 74 00 20 C7
    78 C9 9D C1 1C B2 94 00 20 AC F5 C7 78 C7 78 C9 9D C1 1C 00 20 C7 85 B2 C8 B2 E4 30 2C 06
    08 2B 06 01 05 05 07 02 01 16 20 68 74 74 70 3A 2F 2F 77 77 77 2E 79 65 73 73 69 67 6E 2E
    6F 72 2E 6B 72 2F 63 70 73 2E 68 74 6D 30 68 06 03 55 1D 11 04 61 30 5F A0 5D 06 09 2A 83
    1A 8C 9A 44 0A 01 01 A0 50 30 4E 0C 09 EC 9D B4 EC A4 80 EC 98 A4 30 41 30 3F 06 0A 2A 83
    1A 8C 9A 44 0A 01 01 01 30 31 30 0B 06 09 60 86 48 01 65 03 04 02 01 A0 22 04 20 49 80 0B
    85 9C 32 26 22 E0 F3 A2 7F 8E 77 46 3E F6 06 63 AC C7 73 95 3A A6 D6 40 BF 16 6C 73 8E 30
    72 06 03 55 1D 1F 04 6B 30 69 30 67 A0 65 A0 63 86 61 6C 64 61 70 3A 2F 2F 64 73 2E 79 65
    73 73 69 67 6E 2E 6F 72 2E 6B 72 3A 33 38 39 2F 6F 75 3D 64 70 34 70 35 34 35 34 31 2C 6F
    75 3D 41 63 63 72 65 64 69 74 65 64 43 41 2C 6F 3D 79 65 73 73 69 67 6E 2C 63 3D 6B 72 3F
    63 65 72 74 69 66 69 63 61 74 65 52 65 76 6F 63 61 74 69 6F 6E 4C 69 73 74 30 38 06 08 2B
    06 01 05 05 07 01 01 04 2C 30 2A 30 28 06 08 2B 06 01 05 05 07 30 01 86 1C 68 74 74 70 3A
    2F 2F 6F 63 73 70 2E 79 65 73 73 69 67 6E 2E 6F 72 67 3A 34 36 31 32 30 0D 06 09 2A 86 48
    86 F7 0D 01 01 0B 05 00 03 82 01 01 00 C1 AA 6A 65 59 4F 26 C3 E8 FF FC FE 51 67 3A 9B 1B
    6C 94 8C 64 CF 41 C6 C0 54 BE 75 EB DD 35 3F 30 7B 13 20 9C BE 57 AE 97 84 B1 9F 4D 35 DE
    62 11 23 F0 BA F9 0F AB E1 6A C3 99 45 A7 E1 62 44 FC 55 44 31 D3 A6 4F E2 89 2B 9D FC 6C
    4B 0B 39 99 15 33 82 50 17 BB 75 FB 48 82 80 E8 6E D0 1A 0C FF 53 F1 E8 9A 7B D2 C9 96 51
    84 AA 22 CB E6 04 B4 FB BA 49 F2 B1 69 F1 D1 E9 46 2F 2C 8B F2 BF C4 60 4B 36 09 07 E2 92
    DF 4A 4D CE 1E FA C2 F1 E1 FC B1 39 12 20 68 6E CB 60 AC CD 4A 0E A5 C4 E0 2F D1 93 37 A7
    89 1E 21 7D D8 11 45 56 91 01 E3 2A 4D 7F F5 92 F3 64 C8 EE 57 94 A9 18 0D 12 62 49 CD 4F
    B6 50 64 DC 62 B5 A6 D4 9C D0 0F 7D 56 7C 3F 22 9B 7C 57 A3 58 68 4B 51 71 F4 68 0C F6 99
    F8 04 5C 29 75 25 67 C5 C0 25 93 81 CD 91 6E 09 E3 C4 A6 22 1A DE 4D 2C 19 9A E5 00 0B
    `;

    var signed_cert = Buffer.from(signed_cert_hex.replace(/[ \n\r]/g, ""), 'hex').toString('latin1');

    var asn1 = new jCastle.asn1();
    var obj = asn1.parse(signed_cert);

    //console.log(jCastle.asn1.rasterize(obj));

    var der = asn1.getDER(obj);
    //console.log('der remaking: ', der === signed_cert);

    assert.equal(der, signed_cert, 'DER Remaking Test');

    assert.equal(obj.items[0].items[2].items[0].type, jCastle.asn1.tagOID, 'type test');
    // sha256WithRSAEncryption (PKCS #1)
    assert.equal(obj.items[0].items[2].items[0].value, '1.2.840.113549.1.1.11', 'value test');
});


</script>

</body>
</html>